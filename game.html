<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Match The Flowers! - Game</title>
    <link rel="stylesheet" href="CSS/style.css">
    <style>
        .game-container {
            max-width: 980px;
            margin: 2rem auto;
            padding: 2rem;
            background: var(--primary-color, #202e48);
            border: 1px solid #d7deeb;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.06);
        }
        .game-header { border-bottom: 2px solid #d7deeb; margin-bottom: 1.25rem; padding-bottom: 0.75rem }
        .game-header h2 { color: #d7deeb; font-size: 1.8rem; margin: 0 }
        .controls { display:flex; gap:1rem; align-items:center; justify-content:space-between; margin:1rem 0 }
        .left-controls { display:flex; gap:1rem; align-items:center }
        .start-btn {
            background-color: #4CAF50; color: white; padding: 0.6rem 1rem; border-radius:8px; border:none; cursor:pointer; font-weight:600
        }
        .start-btn:hover { background:#3e8e3e }
        .audio-area { color:#d7deeb }

        .cards-grid { display:grid; grid-template-columns: repeat(5, 1fr); gap:1rem; justify-items:center; margin-top:1rem }

        .card { width:120px; height:170px; perspective:1000px }
        .card-inner { width:100%; height:100%; position:relative; transform-style:preserve-3d; transition:transform 0.6s }
        .card.flipped .card-inner { transform:rotateY(180deg) }

        .card-face { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; backface-visibility:hidden; border-radius:12px; overflow:hidden }
        .card-front { transform:rotateY(180deg); background:#fff }
        .card-front img { width:90px; height:120px; object-fit:cover; border-radius:8px }
        .card-back { background:#bcc0c6 }

        .status { color:#d7deeb; font-size:0.95rem }

        @media (max-width:900px) {
            .cards-grid { grid-template-columns: repeat(2, 1fr) }
            .card { width:100px; height:140px }
        }
    </style>
</head>
<body>
    <nav>
        <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="hobbies.html">Hobbies</a></li>
            <li><a href="discover.html">Discover UMD</a></li>
            <li><a href="resume.html">Resume</a></li>
            <li><a href="career.html">Career</a></li>
            <li><a href="game.html">Game</a></li>
        </ul>
    </nav>

    <main>
        <div class="game-container">
            <div class="game-header"><h2>Match The Flowers!</h2></div>

            <div class="controls">
                <div class="left-controls">
                    <button id="startGameBtn" class="start-btn">Start Game</button>
                    <div class="audio-area">
                        <!-- Hidden celebration/background audio (kept for playback). Place file at images/Special - The Grey Room _ Clark Sims.mp3 -->
                        <audio id="matchAudio" preload="metadata" style="display:none;">
                            <source src="images/Special - The Grey Room _ Clark Sims.mp3" type="audio/mpeg">
                        </audio>
                    </div>
                </div>
                <div class="status" id="gameStatus">Pairs matched: 0 / 5</div>
            </div>

            <div id="cardsGrid" class="cards-grid" aria-live="polite">
                <!-- cards populated by JS -->
            </div>
        </div>
    </main>

    <footer>
        <p>&copy; 2025 Jacob Weierke. All rights reserved.</p>
    </footer>

    <script>
    // images (use existing images folder)
    const flowerImages = [
        'images/Petunia.jpg',
        'images/Orchid.jpg',
        'images/Hibiscus.jpg',
        'images/Daisy.jpg',
        'images/Carnation.jpg'
    ];

    // state
    let cards = [];
    let firstCard = null;
    let secondCard = null;
    let lockBoard = false;
    let matchesFound = 0;

    function buildCards() {
        cards = [];
        flowerImages.forEach(img => {
            cards.push({img, id: img + '-1'});
            cards.push({img, id: img + '-2'});
        });
    }

    function shuffle(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    function renderCards() {
        const grid = document.getElementById('cardsGrid');
        grid.innerHTML = '';
        matchesFound = 0;
        firstCard = null; secondCard = null; lockBoard = false;
        document.getElementById('gameStatus').textContent = `Pairs matched: ${matchesFound} / ${flowerImages.length}`;

        const shuffled = shuffle(cards.slice());
        shuffled.forEach(card => {
            const wrapper = document.createElement('div');
            wrapper.className = 'card';
            wrapper.tabIndex = 0;
            wrapper.dataset.img = card.img;
            wrapper.dataset.id = card.id;

            wrapper.innerHTML = `
                <div class="card-inner">
                    <div class="card-face card-front"><img src="${card.img}" alt="flower"></div>
                    <div class="card-face card-back"></div>
                </div>
            `;

            wrapper.addEventListener('click', () => handleCardClick(wrapper));
            wrapper.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); handleCardClick(wrapper); } });

            grid.appendChild(wrapper);
        });
    }

    function handleCardClick(cardEl) {
        if (lockBoard) return;
        if (cardEl === firstCard) return;
        // flip
        cardEl.classList.add('flipped');

        if (!firstCard) {
            firstCard = cardEl;
            return;
        }

        secondCard = cardEl;
        lockBoard = true;
        checkForMatch();
    }

    function checkForMatch() {
        const isMatch = firstCard.dataset.img === secondCard.dataset.img;
        if (isMatch) {
            // keep flipped and disable pointer events
            firstCard.style.pointerEvents = 'none';
            secondCard.style.pointerEvents = 'none';
            matchesFound += 1;
            updateStatus();
            resetTurn();
            if (matchesFound === flowerImages.length) {
                setTimeout(() => alert('Great job! You matched all the flowers.'), 200);
            }
        } else {
            setTimeout(() => {
                firstCard.classList.remove('flipped');
                secondCard.classList.remove('flipped');
                resetTurn();
            }, 900);
        }
    }

    function resetTurn() {
        [firstCard, secondCard] = [null, null];
        lockBoard = false;
    }

    function updateStatus() {
        document.getElementById('gameStatus').textContent = `Pairs matched: ${matchesFound} / ${flowerImages.length}`;
    }

    document.getElementById('startGameBtn').addEventListener('click', () => {
        buildCards();
        renderCards();
        // start hidden audio from halfway when available
        const audio = document.getElementById('matchAudio');
        if (audio) {
            const playFromHalf = () => {
                try {
                    const half = (isFinite(audio.duration) && audio.duration > 0) ? audio.duration / 2 : 0;
                    audio.currentTime = half;
                } catch (e) {
                    // ignore if cannot set currentTime
                }
                audio.play().catch(() => {});
            };

            if (audio.readyState >= 1 && isFinite(audio.duration) && audio.duration > 0) {
                playFromHalf();
            } else {
                const onMeta = function() {
                    playFromHalf();
                    audio.removeEventListener('loadedmetadata', onMeta);
                };
                audio.addEventListener('loadedmetadata', onMeta);
                try { audio.load(); } catch (e) {}
            }
        }
    });
    </script>
</body>
</html>
